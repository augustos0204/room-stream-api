<!-- Chat Section Component -->
<div class="<%= isMobile ? 'h-full flex flex-col' : 'flex-1 flex flex-col overflow-hidden' %>" x-show="currentRoomId">
    <!-- Room Header -->
    <div class="flex-shrink-0 dark-glass rounded-xl p-4 mb-4 shadow-xl animate-slide-up">
        <div class="flex items-center justify-between">
            <div class="flex items-center gap-3">
                <i data-lucide="hash" class="w-5 h-5 text-yellow-400"></i>
                <h2 class="text-lg font-semibold text-yellow-400 <%= isMobile ? 'truncate' : '' %>" x-text="currentRoomName || 'Sala'"></h2>
                <% if (!isMobile) { %>
                <span class="text-xs text-gray-400" x-text="'ID: ' + currentRoomId"></span>
                <% } %>
            </div>
            <div class="flex items-center gap-2">
                <button @click="getRoomInfo()" :disabled="!isConnected"
                        class="px-3 py-1 bg-cyan-600 hover:bg-cyan-700 disabled:bg-gray-600 text-white rounded text-xs transition-all">
                    <i data-lucide="info" class="w-3 h-3"></i>
                </button>
                <button @click="<%= isMobile ? "leaveCurrentRoom(); setMobileSection('rooms')" : "leaveCurrentRoom()" %>"
                        class="px-3 py-1 bg-red-600 hover:bg-red-700 text-white rounded text-xs transition-all">
                    <i data-lucide="log-out" class="w-3 h-3"></i>
                </button>
            </div>
        </div>
    </div>

    <!-- Event Logs -->
    <div class="flex-1 dark-glass rounded-xl shadow-xl animate-slide-up mb-4 flex flex-col overflow-hidden">
        <!-- Log Header -->
        <div class="flex-shrink-0 p-4 pb-3 border-b border-purple-500/30">
            <div class="flex justify-between items-center">
                <div class="flex items-center gap-3">
                    <i data-lucide="terminal" class="w-5 h-5 text-gray-300"></i>
                    <h2 class="text-lg font-semibold text-gray-300"><%= isMobile ? 'Chat' : 'Eventos da Sala' %></h2>
                    <span x-show="roomLogs.length > 0"
                          class="px-2 py-1 bg-gray-600/20 text-gray-300 rounded-full text-xs"
                          x-text="roomLogs.length"></span>
                </div>
                <button @click="clearRoomLogs()"
                        class="<%= isMobile ? 'p-2' : 'px-3 py-1' %> bg-gray-600 hover:bg-gray-500 text-white rounded text-sm transition-all duration-200 transform hover:scale-105 active:scale-95 flex items-center gap-2">
                    <i data-lucide="trash-2" class="w-3 h-3"></i>
                    <% if (!isMobile) { %>
                    <span>Limpar</span>
                    <% } %>
                </button>
            </div>
        </div>

        <!-- Log Content -->
        <div class="flex-1 overflow-y-auto bg-gray-900 m-4 rounded-lg p-4 border border-gray-700 custom-scrollbar" x-ref="roomLogContainer">
            <template x-if="roomLogs.length === 0">
                <div class="flex flex-col items-center justify-center h-full text-gray-500">
                    <i data-lucide="message-square" class="w-12 h-12 mb-4 opacity-50"></i>
                    <p class="text-center"><%= isMobile ? 'Aguardando mensagens...' : 'Aguardando eventos da sala...' %></p>
                    <% if (!isMobile) { %>
                    <p class="text-xs text-center mt-2">Entre em uma sala para ver as atividades</p>
                    <% } %>
                </div>
            </template>

            <div class="space-y-3">
                <template x-for="(log, index) in roomLogs" :key="index">
                    <div class="animate-fade-in">
                        <!-- System Messages -->
                        <template x-if="log.type === 'info' || log.type === 'success'">
                            <div class="rounded-lg p-<%= isMobile ? '3' : '4' %> border-l-4"
                                 :class="log.type === 'info' ? 'bg-blue-900/30 border-l-blue-400 border border-blue-700/30' : 'bg-green-900/30 border-l-green-400 border border-green-700/30'">
                                <div class="flex items-start gap-3">
                                    <div class="flex-shrink-0 mt-0.5">
                                        <i :data-lucide="getLogIcon(log.type)"
                                           class="w-5 h-5"
                                           :class="log.type === 'info' ? 'text-blue-400' : 'text-green-400'"></i>
                                    </div>
                                    <div class="flex-1 min-w-0">
                                        <% if (!isMobile) { %>
                                        <div class="flex items-center gap-2 mb-2">
                                            <span class="text-xs px-2 py-1 rounded-full font-semibold uppercase tracking-wide"
                                                  :class="log.type === 'info' ? 'bg-blue-700/40 text-blue-300' : 'bg-green-700/40 text-green-300'"
                                                  x-text="log.type === 'info' ? 'SISTEMA' : 'SUCESSO'"></span>
                                        </div>
                                        <% } %>
                                        <div class="text-sm break-words"
                                             :class="log.type === 'info' ? 'text-blue-100' : 'text-green-100'"
                                             x-html="log.message"></div>
                                        <div class="text-xs text-gray-400 mt-<%= isMobile ? '1' : '2' %> font-mono" x-text="log.fullTimestamp"></div>
                                    </div>
                                </div>
                            </div>
                        </template>

                        <!-- User Messages -->
                        <template x-if="log.type === 'user_message'">
                            <div class="bg-gray-800/40 rounded-lg p-3 hover:bg-gray-800/60 transition-all border border-gray-700/50">
                                <div class="flex items-start gap-3">
                                    <div class="w-8 h-8 bg-gradient-to-br from-purple-500 to-blue-600 rounded-full flex items-center justify-center flex-shrink-0">
                                        <i data-lucide="user" class="w-4 h-4 text-white"></i>
                                    </div>
                                    <div class="flex-1 min-w-0">
                                        <div class="flex items-center gap-2 mb-<%= isMobile ? '1' : '2' %>">
                                            <span class="font-semibold text-white text-sm" x-text="log.displayName || log.sender || 'Usuário Anônimo'"></span>
                                            <span x-show="log.isMe" class="px-2 py-0.5 bg-purple-600/20 text-purple-300 rounded text-xs">Você</span>
                                        </div>
                                        <div class="text-sm text-gray-100 break-words" x-text="log.message"></div>
                                        <div class="text-xs text-gray-400 mt-<%= isMobile ? '1' : '2' %> font-mono" x-text="log.fullTimestamp"></div>
                                    </div>
                                </div>
                            </div>
                        </template>

                        <!-- Other Events -->
                        <template x-if="log.type !== 'info' && log.type !== 'success' && log.type !== 'user_message'">
                            <div class="flex items-start gap-2 py-2 px-3 rounded-lg transition-all hover:bg-gray-800/50" :class="getLogClass(log.type)">
                                <div class="flex-shrink-0 mt-0.5">
                                    <i :data-lucide="getLogIcon(log.type)" class="w-4 h-4"></i>
                                </div>
                                <div class="flex-1 min-w-0">
                                    <div class="flex items-center gap-2 mb-1">
                                        <span class="text-xs px-2 py-1 rounded-full bg-gray-800 text-gray-300 uppercase tracking-wide font-semibold" x-text="log.type"></span>
                                    </div>
                                    <div class="text-sm break-words" x-html="log.message"></div>
                                    <div class="text-xs text-gray-500 mt-1 font-mono" x-text="log.fullTimestamp"></div>
                                </div>
                            </div>
                        </template>
                    </div>
                </template>
            </div>
        </div>
    </div>

    <!-- Message Input -->
    <div class="flex-shrink-0 dark-glass rounded-xl p-4 shadow-xl animate-slide-up">
        <% if (!isMobile) { %>
        <div class="flex items-center gap-3 mb-3">
            <i data-lucide="message-circle" class="w-5 h-5 text-green-400"></i>
            <h2 class="text-lg font-semibold text-green-400">Enviar Mensagem</h2>
        </div>
        <% } %>

        <div class="flex items-stretch gap-3">
            <div class="flex-1 relative">
                <textarea x-model="message" placeholder="Digite sua mensagem..." rows="2"
                          @keydown.ctrl.enter="sendMessage()"
                          @keydown.cmd.enter="sendMessage()"
                          class="w-full h-full bg-gray-700 text-white px-3 py-2 <%= isMobile ? 'pr-16' : 'pr-24' %> rounded-lg border border-gray-600 focus:border-green-400 focus:outline-none focus:ring-2 focus:ring-green-400/20 transition-all resize-none"></textarea>
                <div class="absolute bottom-2 right-2 text-xs text-gray-400">
                    <span <%= isMobile ? '' : 'class="hidden sm:inline"' %>>Ctrl+</span>Enter
                </div>
            </div>
            <button @click="sendMessage()" :disabled="!isConnected || !currentRoomId || !message.trim()"
                    class="<%= isMobile ? 'px-4' : 'px-6' %> bg-gradient-to-r from-green-600 to-green-700 hover:from-green-700 hover:to-green-800 disabled:from-gray-600 disabled:to-gray-700 text-white rounded-lg transition-all duration-300 transform hover:scale-105 active:scale-95 shadow-lg shadow-green-500/25 disabled:shadow-none disabled:cursor-not-allowed flex items-center gap-2">
                <i data-lucide="send" class="w-4 h-4"></i>
                <% if (!isMobile) { %>
                <span>Enviar</span>
                <% } %>
            </button>
        </div>
    </div>
</div>

<!-- No room selected placeholder -->
<div class="flex-1 flex items-center justify-center" x-show="!currentRoomId">
    <div class="text-center text-gray-500 <%= isMobile ? 'p-8' : '' %>">
        <i data-lucide="message-square-plus" class="w-16 h-16 mx-auto mb-4 opacity-50"></i>
        <h3 class="text-lg font-semibold mb-2"><%= isMobile ? 'Selecione uma Sala' : 'Selecione uma Sala' %></h3>
        <p class="text-sm <%= isMobile ? 'mb-4' : '' %>"><%= isMobile ? 'Vá para "Salas" para escolher uma sala e começar a conversar' : 'Escolha uma sala na sidebar esquerda para começar a conversar' %></p>
        <% if (isMobile) { %>
        <button @click="setMobileSection('rooms')"
                class="px-4 py-2 bg-purple-600 hover:bg-purple-700 text-white rounded-lg transition-all">
            Ver Salas
        </button>
        <% } %>
    </div>
</div>
