<!-- Login Form Partial - Switch + Forms (Supabase & API Key) -->

<!-- Tabs: Supabase ou API Key -->
<!-- Switch sempre visível, mas mostra apenas opções disponíveis -->
<div class="relative flex gap-2 mb-6 p-1 bg-gray-800/50 rounded-lg">
    <!-- Sliding Background (GPU-accelerated with transform) -->
    <% const hasMultipleAuthMethods = features.supabaseAuth && features.apiKeyAuth; %>
    <div 
        class="absolute inset-y-1 left-1 rounded-lg transition-transform duration-300 ease-out shadow-lg will-change-transform"
        :class="[
            loginMethod === 'supabase' 
                ? 'bg-gradient-to-r from-green-600 to-emerald-600' 
                : 'bg-gradient-to-r from-purple-600 to-pink-600',
            <% if (hasMultipleAuthMethods) { %>
            loginMethod === 'supabase' ? 'translate-x-0' : 'translate-x-full'
            <% } else { %>
            'translate-x-0'
            <% } %>
        ]"
        <% if (hasMultipleAuthMethods) { %>
        style="width: calc(50% - 8px);"
        <% } else { %>
        style="width: calc(100% - 8px);"
        <% } %>
    ></div>
    
    <!-- Botão Supabase (apenas se disponível) -->
    <% if (features.supabaseAuth) { %>
    <button
        @click="loginMethod = 'supabase'"
        class="relative z-10 flex-1 px-4 py-2 rounded-lg font-medium text-sm transition-colors duration-200"
        :class="loginMethod === 'supabase' 
            ? 'text-white' 
            : 'text-gray-400 hover:text-gray-200'"
    >
        <i data-lucide="shield-check" class="w-4 h-4 inline-block mr-2"></i>
        E-mail
    </button>
    <% } %>
    
    <!-- Botão API Key (apenas se disponível) -->
    <% if (features.apiKeyAuth) { %>
    <button
        @click="loginMethod = 'apikey'"
        class="relative z-10 flex-1 px-4 py-2 rounded-lg font-medium text-sm transition-colors duration-200"
        :class="loginMethod === 'apikey' 
            ? 'text-white' 
            : 'text-gray-400 hover:text-gray-200'"
    >
        <i data-lucide="key" class="w-4 h-4 inline-block mr-2"></i>
        API Key
    </button>
    <% } %>
</div>

<!-- Forms Container with Grid Stacking (altura dinâmica) -->
<div class="grid [&>*]:col-start-1 [&>*]:row-start-1 overflow-hidden">
    <!-- Supabase Login (GPU-accelerated) -->
    <% if (features.supabaseAuth) { %>
    <div 
        x-show="loginMethod === 'supabase'" 
        x-transition:enter="transition-[transform,opacity] duration-300 ease-out"
        x-transition:enter-start="opacity-0 translate-x-8"
        x-transition:enter-end="opacity-100 translate-x-0"
        x-transition:leave="transition-[transform,opacity] duration-200 ease-in"
        x-transition:leave-start="opacity-100 translate-x-0"
        x-transition:leave-end="opacity-0 -translate-x-8"
        class="w-full space-y-4 will-change-[transform,opacity]"
    >
        <div>
            <label class="block text-sm font-medium text-gray-300 mb-2">
                <i data-lucide="mail" class="w-4 h-4 inline-block mr-1"></i>
                Email
            </label>
            <input
                x-model="supabaseEmail"
                type="email"
                placeholder="seu-email@exemplo.com"
                @keydown.enter="handleSupabaseLogin()"
                class="w-full px-4 py-3 bg-gray-800/50 border border-gray-700 rounded-lg text-white placeholder-gray-500 focus:outline-none focus:ring-2 focus:border-green-500 focus:ring-green-500/50"
            />
        </div>

        <div>
            <label class="block text-sm font-medium text-gray-300 mb-2">
                <i data-lucide="lock" class="w-4 h-4 inline-block mr-1"></i>
                Senha
            </label>
            <input
                x-model="supabasePassword"
                type="password"
                placeholder="Sua senha"
                @keydown.enter="handleSupabaseLogin()"
                class="w-full px-4 py-3 bg-gray-800/50 border border-gray-700 rounded-lg text-white placeholder-gray-500 focus:outline-none focus:ring-2 focus:border-green-500 focus:ring-green-500/50"
            />
        </div>

        <!-- Error Message -->
        <div x-show="supabaseError" x-transition class="bg-red-900/30 border border-red-500/50 text-red-300 px-4 py-3 rounded-lg text-sm">
            <div class="flex items-start gap-2">
                <i data-lucide="alert-circle" class="w-4 h-4 flex-shrink-0 mt-0.5"></i>
                <span x-text="supabaseError"></span>
            </div>
        </div>

        <button
            @click="handleSupabaseLogin()"
            :disabled="supabaseLoading"
            class="w-full px-6 py-3 bg-gradient-to-r from-green-600 to-emerald-600 hover:from-green-700 hover:to-emerald-700 disabled:from-gray-600 disabled:to-gray-700 text-white font-medium rounded-lg transition-all duration-200 transform hover:scale-[1.02] active:scale-[0.98] disabled:scale-100 shadow-lg shadow-green-500/25 disabled:shadow-none disabled:cursor-not-allowed flex items-center justify-center gap-2"
        >
            <span x-show="!supabaseLoading" class="flex items-center gap-2">
                <i data-lucide="log-in" class="w-5 h-5"></i>
                Entrar
            </span>
            <span x-show="supabaseLoading" class="flex items-center gap-2">
                <div class="w-5 h-5 border-2 border-white border-t-transparent rounded-full animate-spin"></div>
                Entrando...
            </span>
        </button>
    </div>
    <% } %>

    <!-- API Key Login (GPU-accelerated) -->
    <% if (features.apiKeyAuth) { %>
    <div 
        x-show="loginMethod === 'apikey'" 
        x-transition:enter="transition-[transform,opacity] duration-300 ease-out"
        x-transition:enter-start="opacity-0 -translate-x-8"
        x-transition:enter-end="opacity-100 translate-x-0"
        x-transition:leave="transition-[transform,opacity] duration-200 ease-in"
        x-transition:leave-start="opacity-100 translate-x-0"
        x-transition:leave-end="opacity-0 translate-x-8"
        class="w-full space-y-4 will-change-[transform,opacity]"
    >
        <div>
            <label class="block text-sm font-medium text-gray-300 mb-2">
                <i data-lucide="user" class="w-4 h-4 inline-block mr-1"></i>
                Seu Nome (opcional)
            </label>
            <input
                x-model="participantName"
                type="text"
                placeholder="Como deseja ser chamado?"
                class="w-full px-4 py-3 bg-gray-800/50 border border-gray-700 rounded-lg text-white placeholder-gray-500 focus:outline-none focus:ring-2 focus:border-purple-500 focus:ring-purple-500/50"
            />
        </div>

        <div>
            <label class="block text-sm font-medium text-gray-300 mb-2">
                <i data-lucide="key" class="w-4 h-4 inline-block mr-1"></i>
                API Key
            </label>
            <input
                x-model="apiKeyInput"
                type="password"
                placeholder="Digite sua API Key"
                @keydown.enter="handleApiKeyLogin()"
                class="w-full px-4 py-3 bg-gray-800/50 border border-gray-700 rounded-lg text-white placeholder-gray-500 focus:outline-none focus:ring-2 focus:border-purple-500 focus:ring-purple-500/50"
            />
        </div>

        <button
            @click="handleApiKeyLogin()"
            class="w-full px-6 py-3 bg-gradient-to-r from-purple-600 to-pink-600 hover:from-purple-700 hover:to-pink-700 text-white font-medium rounded-lg transition-all duration-200 transform hover:scale-[1.02] active:scale-[0.98] shadow-lg shadow-purple-500/25 flex items-center justify-center gap-2"
        >
            <i data-lucide="log-in" class="w-5 h-5"></i>
            Entrar
        </button>
    </div>
    <% } %>
</div>
